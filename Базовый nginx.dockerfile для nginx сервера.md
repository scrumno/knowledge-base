#docker #nginx

*Dockerfile*

```Dockerfile
# Задаём базовый образ для контейнера
# nginx:stable-alpine — минималистичная версия Nginx на основе Alpine Linux. Alpine — легковесный дистрибутив, обеспечивающий компактный образ (~5 МБ). stable указывает на стабильную версию Nginx.
# Суть: Контейнер наследует конфигурацию и зависимости Nginx из этого образа.
FROM nginx:stable-alpine

# Устанавливаем переменные окружения.
# Можно динамически ссылаться на laravel как на пользователя и группу в других командах.
ENV NGINXUSER=laravel
ENV NGINXGROUP=laravel

# Создаём директорию в контейнере
# Флаг -p предотвращает ошибку, если директория уже существует
# /var/www/html - стандартная директория для веб-контента в Nginx
# Так мы гарантируем наличие директории для размещения веб-файлов (например, приложения Laravel).
RUN mkdir -p /var/www/html

# Копируем файл конфигурации в наш контейнер
# Первый аргумент - наша локальная директория
# Второй аргумент - директория внутри контейнера
# Таким образом, мы определяем как сервер будет обрабатывать запросы (например, для Laravel)
ADD nginx/default.conf /etc/nginx/conf.d/default.conf
# P.S. ADD может распаковывать архивы, но здесь используется для простого копирования

# Изменяем конфигурационный файл Nginx
# *sed -i => выполняет замену текста в файле /etc/nginx/nginx.conf "на месте"
# **-i => этот флаг изменяет файл напрямую
#
# *"s/user www-data/user laravel/g" => заменяет все вхождения user www-data на user laravel в файле.
# **www-data => стандартный пользователь Nginx в большинстве дистрибутивов
# **laravel => новый пользователь, под которым будет работать Nginx
#
# Здесь мы настраиваем Nginx для работы от имени пользователя laravel вместо www-data для соответствия прав доступа
RUN sed -i "s/user www-data/user laravel/g" /etc/nginx/nginx.conf

# Создаем пользователя и группу в контейнере
# *adduser => команда, для создания пользователя в alpine linux
# **-g ${NGINXGROUP} => задаем группу из переменной
# **-s => устанавливаем оболочку /bin/sh для пользователя
# **-D => создаем системного пользователя без пароля (для сервисов, а не для интерактивного входа)
#
# Здесь мы создаем системного пользователя (в данном случае laravel в группе laravel), который используется Nginx для выполнения процессов, обеспечивая изоляцию и безопасность
RUN adduser -g ${NGINXGROUP} -s /bin/sh -D ${NGINXUSER}
```